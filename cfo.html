<!DOCTYPE HTML>

<head>

  <head>
    <style>
      .circle {
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: space-evenly;
        width: 200px;
        height: 200px;
        border-radius: 50%;
        font-size: 30px;
        color: black;
        text-align: center;
        background: #000;
        border: solid black 1px;
        background: white
      }

      .circle:after {
        content: "";
        width: 100%;
        background-color: black;
        height: 1px;
        position: absolute;
        top: 50%;
      }

      .guarantee {
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: space-evenly;
        width: 200px;
        height: 200px;
        border-radius: 50%;
        font-size: 30px;
        color: black;
        text-align: center;
        background: #000;
        border: solid black 1px;
        background: white
      }
    </style>
    <script src='https://unpkg.com/jspsych@7.3.3'></script> <!--This loads the jsPsych package-->
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.2"></script>
    <!--This loads in the plugin that shows text on the screen-->
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@1.1.2"></script>
    <!--This loads in the plugin that shows images and then records a response-->
    <script src="https://unpkg.com/@jspsych/plugin-survey-multi-choice@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.2"></script>
    <!--This loads in the plugin that preloads your images for your participant-->
    <link href="https://unpkg.com/jspsych@7.3.3/css/jspsych.css" rel="stylesheet" type="text/css" />
    <style>
      #jspsych-content {
        max-width: 800px;
        margin: 0 auto;
      }
    </style>
  </head>

  </html>

  <script>
    //DEFAULT: guarantee on left
    //if reverse_code = 0, e key press is guarantee
    //shuffle function to use on values


    var jsPsych = initJsPsych({
      on_finish: function () {
        jsPsych.data.displayData();
      }
    });

    var base_endowment = '$' + '5'

    var s_index = 0
    var s_reversecodes = []

    var b_index = 0
    var b_reversecodes = []

    var w_index = 0
    var w_reversecodes = []

    let s_index_array = Array.from({ length: 90 }, (_, i) => i);
    let w_index_array = Array.from({ length: 90 }, (_, i) => i);
    let b_index_array = Array.from({ length: 90 }, (_, i) => i);

    // Creates random indexes for self, black, white values to be used on field1,2,3
    for (let i = s_index_array.length - 1; i > 0; i--) {
      let j = Math.floor(Math.random() * (i + 1));
      [s_index_array[i], s_index_array[j]] = [s_index_array[j], s_index_array[i]];
    }

    for (let i = w_index_array.length - 1; i > 0; i--) {
      let j = Math.floor(Math.random() * (i + 1));
      [w_index_array[i], w_index_array[j]] = [w_index_array[j], w_index_array[i]];
    }

    for (let i = b_index_array.length - 1; i > 0; i--) {
      let j = Math.floor(Math.random() * (i + 1));
      [b_index_array[i], w_index_array[j]] = [b_index_array[j], b_index_array[i]];
    }




    //gamble wins
    let field1 = [2, 2, 2, 2, 2, 2, 2, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5,
      6, 6, 6, 6, 6, 6, 6, 6, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10,
      10, 10, 10, 10, 12, 12, 12, 12, 12, 12, 12, 12, 5, 5, 8, 8, 3.25, 4, 4, 5, 5, 7,
      8, 7, 8, 12, 12, 13, 10, 11, 13, 19, 17, 25, 17, 22, 25, 26, 24, 30, 22, 28];

    //gamble losses
    let field2 = [3.75, 3.25, 2.75, 2.25, 1.75, 1.25, 0.75, 8, 7, 6, 5,
      4, 3, 2, 1, 9.38, 8.13, 6.88, 5.63, 4.38, 3.13, 1.88, 12, 10.5, 9,
      7.5, 6, 4.5, 3, 1.5, 15, 13, 11, 9, 7, 5, 3, 18, 15.75, 13.5, 11.25,
      9, 6.75, 4.5, 2.25, 18.75, 16.25, 13.75, 11.25, 8.75, 6.25, 3.75, 24,
      21, 18, 15, 12, 9, 6, 3, 5, 2.5, 6, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

    //guarantees
    let field3 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 2.25, 2, 3, 3, 3, 4, 4.25, 4,
      5, 5, 6, 6, 6, 8, 9, 9, 10, 10, 10, 10, 12, 12, 13, 13];

      var resultMessage = '';

    fee = 3
    var timeline = [];

    var fake_face_array = [
      '<img src = "img/Null_Lures/CFD-AF-216-106-N.jpg" style = "width: 200px; height: 200px;">',
      '<img src = "img/Null_Lures/CFD-AF-222-134-N.jpg" style = "width: 200px; height: 200px;">' ,
      '<img src = "img/Null_Lures/CFD-AM-234-355-N.jpg" style = "width: 200px; height: 200px;">' ,
      '<img src = "img/Null_Lures/CFD-BF-207-004-N.jpg" style = "width: 200px; height: 200px;">',
      '<img src = "img/Null_Lures/CFD-BM-218-132-N.jpg" style = "width: 200px; height: 200px;">',
      '<img src = "img/Null_Lures/CFD-BM-249-235-N.jpg" style = "width: 200px; height: 200px;">', 
      '<img src = "img/Null_Lures/CFD-LF-202-065-N.jpg" style = "width: 200px; height: 200px;">',
      '<img src = "img/Null_Lures/image.png" style = "width: 200px; height: 200px;">',
      '<img src = "img/Null_Lures/image_2.png" style = "width: 200px; height: 200px;">',
      '<img src = "img/Null_Lures/image_3.png" style = "width: 200px; height: 200px;">',
      '<img src = "img/Null_Lures/image_4.png" style = "width: 200px; height: 200px;">'
    ]
    var randomized_fakes = jsPsych.randomization.repeat(fake_face_array, 1)
    console.log(randomized_fakes)

    var prolific_id = jsPsych.data.getURLVariable('PROLIFIC_PID');
    jsPsych.data.addProperties({
      prolific_id: prolific_id
    });

    var consent = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus:
        //<div style="text-align: left;"><span style="font-size:22px;">
        `<u><h1>Consent Form</h1></u>
     <br>
     This survey should take about 25 minutes. You will be compensated with a flat rate of $${fee} for participation.
     <br>
    The purpose of this study is to help us understand how people make everyday judgments. Please read carefully and answer the questions thoughtfully.
    <br>
    Participating is completely voluntary - if you wish to stop participating at any time, simply close your browser window. 
    At the end of the survey you will be provided with a randomly generated personalized password.
    <br>
    Of course, your responses are and will remain anonymous at all times, and none of the information you provide will make it possible to identify you.
    <br><br>
    If you have any questions regarding the study, you may contact Dr. Amy Krosch at amy.krosch@cornell.edu. 
    If you have any questions or concerns regarding your rights as a subject in this study, 
    you may contact the Institutional Review Board (IRB) at 607/255.5138 or access their website at http://www.irb.cornell.edu. 
    You may also report your concerns or complaints anonymously through Ethicspoint or by calling toll free at 866/293.3077. 
    Ethicspoint is an independent organization that serves as a liaison between the University and the person bringing the complaint so that anonymity can be ensured.
    <br><br>
    If you consent to take part in this survey, please <b>press the space bar to advance.</b>
   `
      //</div>
      ,
      choices: " "
    }

    const get_id = {
      type: jsPsychSurveyText,
      questions: [{prompt: "Prolific ID:", value: prolific_id}],
      preamble: ["Please enter your Prolific ID below.<br><br>If you do not enter your ID accurately, we may not be able to pay you the correct amount."],
      data:{
        task: 'prolific_id'
      },
      on_finish: function(data) {
          given_id = data.response.Q0;
          jsPsych.data.addProperties({
    	      given_id: given_id,

	      });
      }
    };

    var survey_instructions = {
      timeline: [
      {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: '<p> This is a study about monetary decision-making. We want to know how you make decisions for yourself and for others. ' +
      'First, continue to read the instructions and see the photos of the other participants you will be making decisions for today. <p>' +
      '<p> You can press the space bar to progress through the pages in this study. </p>',
      choices: " "
      },

      {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: function () {
          return `<SELF></SELF>
    <br><div style="text-align: center;"><img src="https://cornell.ca1.qualtrics.com/CP/Graphic.php?IM=IM_blOXRO3gUaBskQe" style="width: 275px; height: 275px;"></div>
    <div>&nbsp;</div>
    <div style="text-align: center;"><strong>You</strong></div><div style="text-align: center;"><strong><br></strong></div>` +
    '<p> This is a study about monetary decision-making, so to start things off, we have just endowed you with ' + base_endowment + '</p>' +
    '<p> This is now your money! If you do well in the study today, we will just add to that, and pay you more (potentially twice that). ' + 
    'If you do poorly, you will have to give me some of that back, but for all intents and purposes, that is now your money. </p>' +
    '<p><b> Please press the space bar to advance.</b></p>'
    },
    choices: " "
    },

    {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `<p> Next you will be deciding for people from our previous group of respondents. 
      At the end of the study, you will also be given the option to opt-in to send a picture for use in a future decision-making study 
      where you could potentially receive money based on other's choices. Further elaboration regarding clothing requirements and picture formatting 
      will be given at the end of the study if you choose to opt-in. </p>` +
      '<p><b> Please press the space bar to advance.</b></p>',
      choices: " "
      },
    ]};

  var decoy_database = {
    timeline: [
    {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: function(){
        return `This is a group of participants that chose to opt-in from our previous group of respondents. 
          We will select&nbsp;<strong>two</strong>&nbsp;of them via a random number generator for you to make decisions for, 
          and you will be managing their endowments on their behalf.<br>` + 
        '<table border="0px" cellpadding="1" cellspacing="1" style="width:100%; margin-left:auto; margin-right:auto">' +
        '<tbody><tr><td style="text-align: center;">' + randomized_fakes[0] + '</td>' +
        '<td style="text-align: center;">' + 'placeholder for personA' + '</td>' +
        '<td style="text-align: center;">' + randomized_fakes[1] + '</td>' +
        '<td style="text-align: center;">' + randomized_fakes[2] + '</td>' +
        '<td style="text-align: center;">' + 'placeholder for white array' + '</td><br></br>' +
        '<table border="0px" cellpadding="1" cellspacing="1" style="width:100%; margin-left:auto; margin-right:auto">' +
        '<tbody><tr><td style="text-align: center;">' + 'placeholder for white array' + '</td>' +
        '<td style="text-align: center;">' + 'placeholder for white array' + '</td>' +
        '<td style="text-align: center;">' + randomized_fakes[4] + '</td>' +
        '<td style="text-align: center;">' + randomized_fakes[5] + '</td>' +
        '<td style="text-align: center;">' + 'placeholder for personB' + '</td><br></br>' + 
        '<table border="0px" cellpadding="1" cellspacing="1" style="width:100%; margin-left:auto; margin-right:auto">' +
        '<tbody><tr><td style="text-align: center;">' + randomized_fakes[6] + '</td>' +
        '<td style="text-align: center;">' + 'placeholder for white array' + '</td>' +
        '<td style="text-align: center;">' + randomized_fakes[7] + '</td>' +
        '<td style="text-align: center;">' + randomized_fakes[8] + '</td>' +
        '<td style="text-align: center;">' + 'placeholder for white array' + '</td><br></br>' +
        '<table border="0px" cellpadding="1" cellspacing="1" style="width:100%; margin-left:auto; margin-right:auto">' +
        '<tbody><tr><td style="text-align: center;">' + randomized_fakes[9] + '</td>' +
        '<td style="text-align: center;">' + randomized_fakes[10] + '</td>' +
        '<td style="text-align: center;">' + randomized_fakes[3] + '</td>' +
        '<td style="text-align: center;">' + 'placeholder for white array' + '</td>' +
        '<td style="text-align: center;">' + 'placeholder for white array' + '</td>' 
        '</tr></tbody></table>' 

      }
    ,
    choices: " ",
    }
    ]
  }

    const circles = {
      guar: `    
      <guar></guar><div style="flex: 1; text-align: center;">
        <div class="guarantee" style = "margin: auto;">
          <div id="guar"><span style="color:#ffffff;">$</span></div>
        </div> 
      </div>`,
      gamble: `<gamble></gamble><div style="flex: 1; text-align: center;">
          <div class="circle" style = "margin: auto;">
            <div id="field1"><span style="color:#ffffff;">+ $</span></div>
            <div id="field2"><span style="color:#ffffff;">- $</span></div>
          </div>
      </div>`}
    var guarOrGamb = [circles.guar, circles.gamble];



    function createResultTrial(resultMessage) {
      return {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: resultMessage,
        choices: [],  // no response needed, the trial ends after 'trial_duration'
        trial_duration: 2000  // show the result for 2 seconds
      };
    }


    function createSELFtrials() {
      var decisionTrial = {
        type: jsPsychHtmlKeyboardResponse,
        prompt: `<br><b>Press "E" on your keyboard for the left option or "I" on your keyboard for the right option.</b><br>`,
        stimulus: function () {
          return `<SELF></SELF>
    <br><div style="text-align: center;"><img src="https://cornell.ca1.qualtrics.com/CP/Graphic.php?IM=IM_blOXRO3gUaBskQe" style="width: 275px; height: 275px;"></div>
    <div>&nbsp;</div>
    <div style="text-align: center;"><strong>You</strong></div><div style="text-align: center;"><strong><br></strong></div>
    Choose one of the following. The gamble decision has a 50% outcome for either of the presented outcomes.&nbsp; The sure bet has a 100% chance of the presented outcome.<br><br>
                
    <div style="display: flex; justify-content: space-between;">
                ${guarOrGamb[0]}${guarOrGamb[1]}
    </div>`},
        choices: ['e', 'i'],
        on_load: function () {
          window.focus();
          if (guarOrGamb[0] == circles.guar) {
            s_reversecodes[s_index] = 0
          } else {
            s_reversecodes[s_index] = 1
          };//whether this trial has guar on left (e) or not
          document.getElementById("guar").innerHTML = '+$' + field3[s_index_array[s_index]];
          document.getElementById("field1").innerHTML = '+$' + field1[s_index_array[s_index]];
          document.getElementById("field2").innerHTML = '-$' + field2[s_index_array[s_index]];
          s_index += 1
        },
        on_finish: function (data) {
          guarOrGamb = guarOrGamb.sort(() => Math.random() - 0.5); //at the end of each trial, position of guar or gamble is randomized
          if (s_reversecodes[s_index - 1] == 0) {
            switch (data.response) {
              case 'e':
                result = "guarantee";
                break;
              default:
                result = "gamble";
                break;
            }
          } else {
            switch (data.response) {
              case 'i':
                result = "guarantee";
                break;
              default:
                result = "gamble";
                break;
            }
          }
          data.response = result;

          var resultMessage;
          if (data.response == 'guarantee') {
            resultMessage = `You took the guaranteed amount and gained $${field3[s_index_array[s_index - 1]]}!`
            var message = {
              amount: [field3[s_index_array[s_index - 1]], field3[s_index_array[s_index - 1]]]
            }
            var index = 0;
          } else {
            var index = (Math.random() >= 0.5) ? 1 : 0;
            var message = {
              outcome: ['won', 'lost'],
              amount: [field1[s_index_array[s_index - 1]], field2[s_index_array[s_index - 1]]]
            }
            resultMessage = `You took the gamble and ${message.outcome[index]} $${message.amount[index]}!`
            console.log(resultMessage);
          }
          jsPsych.data.addDataToLastTrial({ resultMessage: resultMessage });
          jsPsych.data.addDataToLastTrial({ outcome: message.amount[index]})

        }
      }
      var resultTrial = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: function () {

          return `<div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-size: 30px;">` + 
            jsPsych.data.getLastTrialData().trials[0].resultMessage; + `</div>`
        },
        choices: '',
        trial_duration: 1000
      }
      return {timeline: [decisionTrial, resultTrial]}
    };








    timeline.push(consent, get_id, survey_instructions, decoy_database);

    for (let i = 0; i < 4; i++) {
      timeline.push(createSELFtrials());
    }

    jsPsych.run(timeline);


  </script>


  <!-- 
var decTrial2 = {
  type: jsPsychSurveyMultiChoice,
  questions: [
    {
    prompt: `&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <div style="text-align: center;"><img src="https://cornell.ca1.qualtrics.com/CP/Graphic.php?IM=IM_blOXRO3gUaBskQe" style="width: 275px; height: 275px;"></div>
    <div>&nbsp;</div>
    <div style="text-align: center;"><strong>You</strong></div><div style="text-align: center;"><strong><br></strong></div>
    <div style="text-align: center;">Choose one of the following. The gamble decision has a 50% outcome for either of the presented outcomes.&nbsp; The sure bet has a 100% chance of the presented outcome.<br><br>
    <b>Press "E" on your keyboard for the left option or "I" on your keyboard for the right option.</b><br></div>`,
    name: 'decTrial',
    options: [`                <div class='guarantee'>
                <div id='guar'><span style='color:#ffffff;'>$</span></div>
                </div> `,


                `   <div class='circle'>
                <div id='field1'><span style='color:#ffffff;'>+ $</span></div>

                <div id='field2'><span style='color:#ffffff;'>- $</span></div>
                </div>`
              ],
    randomize_question_order: true,
    horizontal: true

  }
],
on_load: function(){
  document.getElementById("guar").innerHTML = '+$'+field3[s_index];
	document.getElementById("field1").innerHTML = '+$'+field1[s_index];
	document.getElementById("field2").innerHTML = '-$'+field2[s_index]; 
  s_index+=1
},
  
} -->