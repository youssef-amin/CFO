<!DOCTYPE HTML>
<head>
    <script src = 'https://unpkg.com/jspsych@7.3.3'></script>  <!--This loads the jsPsych package-->
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.2"></script> <!--This loads in the plugin that shows text on the screen-->
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@1.1.2"></script> <!--This loads in the plugin that shows images and then records a response-->
    <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.2"></script> <!--This loads in the plugin that preloads your images for your participant-->
    <script src="https://unpkg.com/@jspsych/plugin-iat-image@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-iat-html@1.1.2"></script>
    <link rel="stylesheet" href="https://unpkg.com/@jspsych/plugin-survey@0.1.1/css/survey.css">
    <link href="https://unpkg.com/jspsych@7.1.2/css/jspsych.css" rel="stylesheet" type="text/css" />
</head>
</html>

<script>
var jsPsych = initJsPsych({
      on_finish: function(){
        jsPsych.data.displayData();
      }
    });

var timeline = [];


var iat_imgs = [
  {face:'img/IAT_img/B0jpg.jpg'},
  {face:'img/IAT_img/B1jpg.jpg'},
  {face:'img/IAT_img/B2jpg.jpg'},
  {face:'img/IAT_img/B3jpg.jpg'},
  {face:'img/IAT_img/B4jpg.jpg'},
  {face:'img/IAT_img/B5jpg.jpg'},
  {face:'img/IAT_img/B6jpg.jpg'},
  {face:'img/IAT_img/B7jpg.jpg'},
  {face:'img/IAT_img/B8jpg.jpg'},
  {face:'img/IAT_img/B9jpg.jpg'},
  {face:'img/IAT_img/W0jpg.jpg'},
  {face:'img/IAT_img/W1jpg.jpg'},
  {face:'img/IAT_img/W2jpg.jpg'},
  {face:'img/IAT_img/W3jpg.jpg'},
  {face:'img/IAT_img/W4jpg.jpg'},
  {face:'img/IAT_img/W5jpg.jpg'},
  {face:'img/IAT_img/W6jpg.jpg'},
  {face:'img/IAT_img/W7jpg.jpg'},
  {face:'img/IAT_img/W8jpg.jpg'},
  {face:'img/IAT_img/W9jpg.jpg'}
  ]

  var iat_word = [
  {combined: 'Fabulous'},
  {combined: 'Awful'},
  {combined: 'Fantastic'},
  {combined: 'Disgusting'},
  {combined: 'Great'},
  {combined: 'Lovely'},
  {combined: 'Foul'},
  {combined: 'Horrible'},
  {combined: 'Horrid'},
  {combined: 'Nice'},
  {combined: 'Terrific'},
  {combined: 'Nasty'},
  {combined: 'Superb'},
  {combined: 'Revolting'},
  {combined: 'Wonderful'},
  {combined: 'Terrible'}
  ]
  
  var combined_array = [
  {combined: '<img src = img/IAT_img/B0jpg.jpg>'},
  {combined: '<img src = img/IAT_img/B1jpg.jpg>'},
  {combined: '<img src = img/IAT_img/B2jpg.jpg>'},
  {combined: '<img src = img/IAT_img/B3jpg.jpg>'},
  {combined: '<img src = img/IAT_img/B4jpg.jpg>'},
  {combined: '<img src = img/IAT_img/B5jpg.jpg>'},
  {combined: '<img src = img/IAT_img/B6jpg.jpg>'},
  {combined: '<img src = img/IAT_img/B7jpg.jpg>'},
  {combined: '<img src = img/IAT_img/B8jpg.jpg>'},
  {combined: '<img src = img/IAT_img/B9jpg.jpg>'},
  {combined: '<img src = img/IAT_img/W0jpg.jpg>'},
  {combined: '<img src = img/IAT_img/W1jpg.jpg>'},
  {combined: '<img src = img/IAT_img/W2jpg.jpg>'},
  {combined: '<img src = img/IAT_img/W3jpg.jpg>'},
  {combined: '<img src = img/IAT_img/W4jpg.jpg>'},
  {combined: '<img src = img/IAT_img/W5jpg.jpg>'},
  {combined: '<img src = img/IAT_img/W6jpg.jpg>'},
  {combined: '<img src = img/IAT_img/W7jpg.jpg>'},
  {combined: '<img src = img/IAT_img/W8jpg.jpg>'},
  {combined: '<img src = img/IAT_img/W9jpg.jpg>'},
  {combined: 'Fabulous'},
  {combined: 'Awful'},
  {combined: 'Fantastic'},
  {combined: 'Disgusting'},
  {combined: 'Great'},
  {combined: 'Lovely'},
  {combined: 'Foul'},
  {combined: 'Horrible'},
  {combined: 'Horrid'},
  {combined: 'Nice'},
  {combined: 'Terrific'},
  {combined: 'Nasty'},
  {combined: 'Superb'},
  {combined: 'Revolting'},
  {combined: 'Wonderful'},
  {combined: 'Terrible'}
]

var good_words = [
  'Fabulous',
  'Fantastic',
  'Great',
  'Lovely',
  'Nice',
  'Terrific',
  'Superb',
  'Wonderful',
]

var bad_words = [
'Awful',
'Disgusting',
'Foul',
'Horrible',
'Horrid',
'Nasty',
'Revolting',
'Terrible'
]


var iat_instructions = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus:'<h1>Instructions:</h1> <p> Place your left and right index fingers on the E and I keys. At the top of the screen are 2 categories. </p>' +
  '<p>In the task, words and/or images appear in the middle of the screen. </p>' +
  '<p>When the word/image belongs to the category on the left, press the E key as fast as you can. When it belongs to the category on the right, press the I key as fast as you can. </p>' +
  '<p>If you make an error, a red X will appear. Correct errors by hitting the other key. Please try to go as fast as you can while making as few errors as possible.</p>' +
  '<p>When you are ready, press [Space] to begin</p>',
  choices: " "
};

// black (left) and white (right)
var black_left_1 = {
  type: jsPsychIatImage,
  stimulus: jsPsych.timelineVariable('face'),
  stim_key_association: function(){
    if (jsPsych.timelineVariable('face').indexOf('B') > -1){
      return 'left';
    } else
    return 'right';
    },
  html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
  bottom_instructions: 'Remember, if you make an error an X will appear. Please press the other button to continue if this occurs',
  force_correct_key_press: true,
  display_feedback: true,
  trial_duration: 3000, //Only if display_feedback is false
  left_category_key: 'e',
  right_category_key: 'i',
  left_category_label: ['Black Americans'],
  right_category_label: ['White Americans'],
  response_ends_trial: true,
}

//instructions for category change to unpleasant(left) and pleasant(right)
var instr_1 = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus:'<p> Now the categories have changed, but the rules remain the same. </p>' +
  '<p> Please try to go as <em> as fast as you can </em> while making as few errors as possible. Correct errors by hitting the other key </p>' +
  '<p> When you are ready, press [Space] to begin </p>',
  choices: " "
}

//unpleasant (left) and pleasant (right)
var unpleasant_left_1 = {
  type: jsPsychIatHtml,
  stimulus: function(){
    if(good_words.includes(jsPsych.timelineVariable('combined'))){
      stim = '<span style="color: green; font-size: 40px">' +jsPsych.timelineVariable('combined') + '</span>';
      return stim
    } else{
      stim = '<span style="color: red; font-size: 40px">' +jsPsych.timelineVariable('combined') + '</span>';
      return stim
    }
  },
  stim_key_association: function(){
    if (good_words.includes(jsPsych.timelineVariable('combined'))){
        return 'right'
      } else {
        return 'left'
      }
  },
  html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
  bottom_instructions: 'Remember, if you make an error an X will appear. Please press the other button to continue if this occurs',
  force_correct_key_press: true,
  display_feedback: true,
  trial_duration: 3000, //Only if display_feedback is false
  left_category_key: 'e',
  right_category_key: 'i',
  left_category_label: ['Unpleasant'],
  right_category_label: ['Pleasant'],
  response_ends_trial: true
  }

  var pleasant_left_1 = {
  type: jsPsychIatHtml,
  stimulus: function(){
    if(good_words.includes(jsPsych.timelineVariable('combined'))){
      stim = '<span style="color: green; font-size: 40px">' +jsPsych.timelineVariable('combined') + '</span>';
      return stim
    } else{
      stim = '<span style="color: red; font-size: 40px">' +jsPsych.timelineVariable('combined') + '</span>';
      return stim
    }
  },
  stim_key_association: function(){
    if (good_words.includes(jsPsych.timelineVariable('combined'))){
        return 'left'
      } else {
        return 'right'
      }
  },
  html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
  bottom_instructions: 'Remember, if you make an error an X will appear. Please press the other button to continue if this occurs',
  force_correct_key_press: true,
  display_feedback: true,
  trial_duration: 3000, //Only if display_feedback is false
  left_category_key: 'e',
  right_category_key: 'i',
  left_category_label: ['Pleasant'],
  right_category_label: ['Unpleasant'],
  response_ends_trial: true
  }

//instructions for combined category change(black+unpleasant(left) and white+pleasant (right))
var instr_2 = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus:'<p> Now the four categories you saw separately will appear together. Remember, each word/image fits in only one of the four categories. The label/item colors may help you identify the appropriate category. </p>' +
  '<p> Use the E key for the two categories on the left and the I key for the two categories on the right. </p>' +
  '<p> Again, try to go as fast as possible without making mistakes. Correct errors by hitting the other key. Practice this combination now. </p>' +
  '<p> When you are ready, press [Space] to begin </p>',
  choices: " "
}

//combined black+unpleasant(left) and white+pleasant (right)
var black_unpleasant_combined = {
  type: jsPsychIatHtml,
  stimulus: function(){
    if (jsPsych.timelineVariable('combined').indexOf('/') > -1){
      return jsPsych.timelineVariable('combined')
    } 
    else if(good_words.includes(jsPsych.timelineVariable('combined'))){
      stim = '<span style="color: green; font-size: 40px">' +jsPsych.timelineVariable('combined') + '</span>';
      return stim
    } else{
      stim = '<span style="color: red; font-size: 40px">' +jsPsych.timelineVariable('combined') + '</span>';
      return stim
    }
  },
  stim_key_association: function(){
    if (jsPsych.timelineVariable('combined').indexOf('/') > -1){
      if (jsPsych.timelineVariable('combined').indexOf('B') > -1){
        return 'left';
      } else
        return 'right';
        }
    else{
      if (good_words.includes(jsPsych.timelineVariable('combined'))){
        return 'right'
      } else {
        return 'left'
      }
    }
  },
  html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
  bottom_instructions: 'Remember, if you make an error an X will appear. Please press the other button to continue if this occurs',
  force_correct_key_press: true,
  display_feedback: true,
  trial_duration: 3000, //Only if display_feedback is false
  left_category_key: 'e',
  right_category_key: 'i',
  left_category_label: ['Black Americans or Unpleasant'],
  right_category_label: ['White Americans or Pleasant'],
  response_ends_trial: true
}

var black_pleasant_combined = {
  type: jsPsychIatHtml,
  stimulus: function(){
    if (jsPsych.timelineVariable('combined').indexOf('/') > -1){
      return jsPsych.timelineVariable('combined')
    } 
    else if(good_words.includes(jsPsych.timelineVariable('combined'))){
      stim = '<span style="color: green; font-size: 40px">' +jsPsych.timelineVariable('combined') + '</span>';
      return stim
    } else{
      stim = '<span style="color: red; font-size: 40px">' +jsPsych.timelineVariable('combined') + '</span>';
      return stim
    }
  },
  stim_key_association: function(){
    if (jsPsych.timelineVariable('combined').indexOf('/') > -1){
      if (jsPsych.timelineVariable('combined').indexOf('B') > -1){
        return 'left';
      } else
        return 'right';
        }
    else{
      if (good_words.includes(jsPsych.timelineVariable('combined'))){
        return 'left'
      } else {
        return 'right'
      }
    }
  },
  html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
  bottom_instructions: 'Remember, if you make an error an X will appear. Please press the other button to continue if this occurs',
  force_correct_key_press: true,
  display_feedback: true,
  trial_duration: 3000, //Only if display_feedback is false
  left_category_key: 'e',
  right_category_key: 'i',
  left_category_label: ['Black Americans or Pleasant'],
  right_category_label: ['White Americans or Unpleasant'],
  response_ends_trial: true
}

var white_left_1 = {
  type: jsPsychIatImage,
  stimulus: jsPsych.timelineVariable('face'),
  stim_key_association: function(){
    if (jsPsych.timelineVariable('face').indexOf('B') > -1){
      return 'right';
    } else
    return 'left';
    },
  html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
  bottom_instructions: 'Remember, if you make an error an X will appear. Please press the other button to continue if this occurs',
  force_correct_key_press: true,
  display_feedback: true,
  trial_duration: 3000, //Only if display_feedback is false
  left_category_key: 'e',
  right_category_key: 'i',
  left_category_label: ['White Americans'],
  right_category_label: ['Black Americans'],
  response_ends_trial: true
}

var white_unpleasant_combined = {
  type: jsPsychIatHtml,
  stimulus: function(){
    if (jsPsych.timelineVariable('combined').indexOf('/') > -1){
      return jsPsych.timelineVariable('combined')
    } 
    else if(good_words.includes(jsPsych.timelineVariable('combined'))){
      stim = '<span style="color: green; font-size: 40px">' +jsPsych.timelineVariable('combined') + '</span>';
      return stim
    } else{
      stim = '<span style="color: red; font-size: 40px">' +jsPsych.timelineVariable('combined') + '</span>';
      return stim
    }
  },
  stim_key_association: function(){
    if (jsPsych.timelineVariable('combined').indexOf('/') > -1){
      if (jsPsych.timelineVariable('combined').indexOf('B') > -1){
        return 'right';
      } else
        return 'left';
        }
    else{
      if (good_words.includes(jsPsych.timelineVariable('combined'))){
        return 'right'
      } else {
        return 'left'
      }
    }
  },
  html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
  bottom_instructions: 'Remember, if you make an error an X will appear. Please press the other button to continue if this occurs',
  force_correct_key_press: true,
  display_feedback: true,
  trial_duration: 3000, //Only if display_feedback is false
  left_category_key: 'e',
  right_category_key: 'i',
  left_category_label: ['White Americans or Unpleasant'],
  right_category_label: ['Black Americans or Pleasant'],
  response_ends_trial: true
}

var white_pleasant_combined = {
  type: jsPsychIatHtml,
  stimulus: function(){
    if (jsPsych.timelineVariable('combined').indexOf('/') > -1){
      return jsPsych.timelineVariable('combined')
    } 
    else if(good_words.includes(jsPsych.timelineVariable('combined'))){
      stim = '<span style="color: green; font-size: 40px">' +jsPsych.timelineVariable('combined') + '</span>';
      return stim
    } else{
      stim = '<span style="color: red; font-size: 40px">' +jsPsych.timelineVariable('combined') + '</span>';
      return stim
    }
  },
  stim_key_association: function(){
    if (jsPsych.timelineVariable('combined').indexOf('/') > -1){
      if (jsPsych.timelineVariable('combined').indexOf('B') > -1){
        return 'right';
      } else
        return 'left';
        }
    else{
      if (good_words.includes(jsPsych.timelineVariable('combined'))){
        return 'left'
      } else {
        return 'right'
      }
    }
  },
  html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
  bottom_instructions: 'Remember, if you make an error an X will appear. Please press the other button to continue if this occurs',
  force_correct_key_press: true,
  display_feedback: true,
  trial_duration: 3000, //Only if display_feedback is false
  left_category_key: 'e',
  right_category_key: 'i',
  left_category_label: ['White Americans or Unpleasant'],
  right_category_label: ['Black Americans or Pleasant'],
  response_ends_trial: true
}


var black_left_block = {
  timeline: [black_left_1],
  timeline_variables: iat_imgs,
  randomize_order: true,
  on_finish: function(){
    jsPsych.data.addProperties(
      {correctChoice: function(){
        return 'black'
      }}
        )
  }
}

var unpleasant_left_block = {
  timeline: [unpleasant_left_1],
  timeline_variables: iat_word,
  randomize_order: true,
}

var pleasant_left_block = {
  timeline: [pleasant_left_1],
  timeline_variables: iat_word,
  randomize_order: true
}

var black_unpleasant_block = {
  timeline: [black_unpleasant_combined],
  timeline_variables: combined_array,
  randomize_order: true,
}

var black_pleasant_block = {
  timeline: [black_pleasant_combined],
  timeline_variables: combined_array,
  randomize_order: true,
}

var white_left_block = {
  timeline: [white_left_1],
  timeline_variables: iat_imgs,
  randomize_order: true,
  }

var white_unpleasant_block = {
  timeline: [white_unpleasant_combined],
  timeline_variables: combined_array,
  randomize_order: true,
}

var white_pleasant_block = {
  timeline: [white_pleasant_combined],
  timeline_variables: combined_array,
  randomize_order: true,
}
var instr_3 = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus:'<p> The categories will now switch sides. </p>' +
  '<p>Remember to try to go as fast as you can while making as few errors as possible. Correct errors by hitting the other key. </p>' +
  '<p>When you are ready, please press the [Space] bar to begin. </p>',
  choices: " "
}

var instr_4 = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus:'<p> Notice the four categories have been combined again, but in a new configuration. </p>' +
  '<p>Remember to try to go as fast as you can while making as few errors as possible. Correct errors by hitting the other key. </p>' +
  '<p>When you are ready, please press the [Space] bar to begin. </p>',
  choices: " "
}

compat_right = [
  iat_instructions, black_left_block, instr_1, unpleasant_left_block, instr_2, black_unpleasant_block, instr_3,
  white_left_block, instr_4, white_unpleasant_block
]

incompat_right = [
  iat_instructions, black_left_block, instr_1, pleasant_left_block, instr_2, black_pleasant_block, instr_3, white_left_block,
  instr_4, white_pleasant_block
]

compat_left = [
  iat_instructions, white_left_block, instr_1, pleasant_left_block, instr_2, white_pleasant_block, instr_3, black_left_block,
  instr_4, black_pleasant_block
]

incompat_left = [
  iat_instructions, white_left_block, instr_1, unpleasant_left_block, instr_2, white_unpleasant_block, instr_3, 
  black_left_block, instr_4, black_unpleasant_block
]

random_array = [
  compat_right, incompat_right, compat_right, incompat_left
]

active_iat_block = random_array[Math.floor(Math.random() * random_array.length)]

data = []

for (i = 0; i < active_iat_block.length; i++) {
  timeline.push(active_iat_block[i]);
};

jsPsych.run(timeline);


  
jsPsych.data.addProperties(
  {correctChoice: function(){
    const lastTrial = jsPsych.data.get().last(1).values()[0];
    const stimulus = lastTrial.stimulus;
    
    if (stimulus.indexOf('/') > -1){
      if (stimulus.indexOf('B') > -1){
        return 'Black Americans';
      } else
        return 'White Americans';
        }
    else{
      if (good_words.includes(stimulus)){
        return 'Pleasant'
      } else {
        return 'Unpleasant'
      }
}}})

jsPsych.data.addProperties(
  {incorrectChoice: function(){
    const lastTrial = jsPsych.data.get().last(1).values()[0];
    const stimulus = lastTrial.stimulus;
    
    if (stimulus.indexOf('/') > -1){
      if (stimulus.indexOf('B') > -1){
        return 'White Americans';
      } else
        return 'Black Americans';
        }
    else{
      if (good_words.includes(stimulus)){
        return 'Pleasant'
      } else {
        return 'Unpleasant'
      }
}}})

// code for later that is able to slice off the word being displayed by cutting
// everything outside of the ><
//  string = str.substring(
// str.indexOf("<") + 1, 
//        str.lastIndexOf(">"))
//     return string



</script>
