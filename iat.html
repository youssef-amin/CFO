<!DOCTYPE HTML>
<head>
    <script src = 'https://unpkg.com/jspsych@7.3.3'></script>  <!--This loads the jsPsych package-->
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.2"></script> <!--This loads in the plugin that shows text on the screen-->
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@1.1.2"></script> <!--This loads in the plugin that shows images and then records a response-->
    <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.2"></script> <!--This loads in the plugin that preloads your images for your participant-->
    <script src="https://unpkg.com/@jspsych/plugin-iat-image@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-iat-html@1.1.2"></script>
    <link rel="stylesheet" href="https://unpkg.com/@jspsych/plugin-survey@0.1.1/css/survey.css">
    <link href="https://unpkg.com/jspsych@7.1.2/css/jspsych.css" rel="stylesheet" type="text/css" />
</head>
</html>

<script>
var jsPsych = initJsPsych({
      on_finish: function(){
        jsPsych.data.displayData();
      }
    });

var timeline = [];


var iat_imgs = [
  {face:'img/IAT_img/B0jpg.jpg'},
  {face:'img/IAT_img/B1jpg.jpg'},
  {face:'img/IAT_img/B2jpg.jpg'},
  {face:'img/IAT_img/B3jpg.jpg'},
  {face:'img/IAT_img/B4jpg.jpg'},
  {face:'img/IAT_img/B5jpg.jpg'},
  {face:'img/IAT_img/B6jpg.jpg'},
  {face:'img/IAT_img/B7jpg.jpg'},
  {face:'img/IAT_img/B8jpg.jpg'},
  {face:'img/IAT_img/B9jpg.jpg'},
  {face:'img/IAT_img/W0jpg.jpg'},
  {face:'img/IAT_img/W1jpg.jpg'},
  {face:'img/IAT_img/W2jpg.jpg'},
  {face:'img/IAT_img/W3jpg.jpg'},
  {face:'img/IAT_img/W4jpg.jpg'},
  {face:'img/IAT_img/W5jpg.jpg'},
  {face:'img/IAT_img/W6jpg.jpg'},
  {face:'img/IAT_img/W7jpg.jpg'},
  {face:'img/IAT_img/W8jpg.jpg'},
  {face:'img/IAT_img/W9jpg.jpg'}
  ]

  var iat_word = [
  {combined: 'Fabulous'},
  {combined: 'Awful'},
  {combined: 'Fantastic'},
  {combined: 'Disgusting'},
  {combined: 'Great'},
  {combined: 'Lovely'},
  {combined: 'Foul'},
  {combined: 'Horrible'},
  {combined: 'Horrid'},
  {combined: 'Nice'},
  {combined: 'Terrific'},
  {combined: 'Nasty'},
  {combined: 'Superb'},
  {combined: 'Revolting'},
  {combined: 'Wonderful'},
  {combined: 'Terrible'}
  ]
  
  var combined_array = [
  {combined: '<img src = img/IAT_img/B0jpg.jpg>'},
  {combined: '<img src = img/IAT_img/B1jpg.jpg>'},
  {combined: '<img src = img/IAT_img/B2jpg.jpg>'},
  {combined: '<img src = img/IAT_img/B3jpg.jpg>'},
  {combined: '<img src = img/IAT_img/B4jpg.jpg>'},
  {combined: '<img src = img/IAT_img/B5jpg.jpg>'},
  {combined: '<img src = img/IAT_img/B6jpg.jpg>'},
  {combined: '<img src = img/IAT_img/B7jpg.jpg>'},
  {combined: '<img src = img/IAT_img/B8jpg.jpg>'},
  {combined: '<img src = img/IAT_img/B9jpg.jpg>'},
  {combined: '<img src = img/IAT_img/W0jpg.jpg>'},
  {combined: '<img src = img/IAT_img/W1jpg.jpg>'},
  {combined: '<img src = img/IAT_img/W2jpg.jpg>'},
  {combined: '<img src = img/IAT_img/W3jpg.jpg>'},
  {combined: '<img src = img/IAT_img/W4jpg.jpg>'},
  {combined: '<img src = img/IAT_img/W5jpg.jpg>'},
  {combined: '<img src = img/IAT_img/W6jpg.jpg>'},
  {combined: '<img src = img/IAT_img/W7jpg.jpg>'},
  {combined: '<img src = img/IAT_img/W8jpg.jpg>'},
  {combined: '<img src = img/IAT_img/W9jpg.jpg>'},
  {combined: 'Fabulous'},
  {combined: 'Awful'},
  {combined: 'Fantastic'},
  {combined: 'Disgusting'},
  {combined: 'Great'},
  {combined: 'Lovely'},
  {combined: 'Foul'},
  {combined: 'Horrible'},
  {combined: 'Horrid'},
  {combined: 'Nice'},
  {combined: 'Terrific'},
  {combined: 'Nasty'},
  {combined: 'Superb'},
  {combined: 'Revolting'},
  {combined: 'Wonderful'},
  {combined: 'Terrible'}
  ]

var good_words = [
  'Fabulous',
  'Fantastic',
  'Great',
  'Lovely',
  'Nice',
  'Terrific',
  'Superb',
  'Wonderful',
]

var bad_words = [
'Awful',
'Disgusting',
'Foul',
'Horrible',
'Horrid',
'Nasty',
'Revolting',
'Terrible'
]


var iat_instructions = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus:'<h1>Instructions:</h1> <p> Place your left and right index fingers on the E and I keys. At the top of the screen are 2 categories. </p>' +
  '<p>In the task, words and/or images appear in the middle of the screen. </p>' +
  '<p>When the word/image belongs to the category on the left, press the E key as fast as you can. When it belongs to the category on the right, press the I key as fast as you can. </p>' +
  '<p>If you make an error, a red X will appear. Correct errors by hitting the other key. Please try to go as fast as you can while making as few errors as possible.</p>' +
  '<p>When you are ready, press [Space] to begin</p>',
  choices: " "
};

// black (left) and white (right)
var compat_right_1 = {
  type: jsPsychIatImage,
  stimulus: jsPsych.timelineVariable('face'),
  stim_key_association: function(){
    if (jsPsych.timelineVariable('face').indexOf('B') > -1){
      return 'left';
    } else
    return 'right';
    },
  html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
  bottom_instructions: 'Remember, if you make an error an X will appear. Please press the other button to continue if this occurs',
  force_correct_key_press: true,
  display_feedback: true,
  trial_duration: 3000, //Only if display_feedback is false
  left_category_key: 'e',
  right_category_key: 'i',
  left_category_label: ['Black Americans'],
  right_category_label: ['White Americans'],
  response_ends_trial: true
}

//instructions for category change to unpleasant(left) and pleasant(right)
var instr_1 = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus:'<p> Now the categories have changed, but the rules remain the same. </p>' +
  '<p> Please try to go as <em> as fast as you can </em> while making as few errors as possible. Correct errors by hitting the other key </p>' +
  '<p> When you are ready, press [Space] to begin </p>',
  choices: " "
}

//unpleasant (left) and pleasant (right)
var compat_right_2 = {
  type: jsPsychIatHtml,
  stimulus: function(){
    if(good_words.includes(jsPsych.timelineVariable('combined'))){
      stim = '<span style="color: green; font-size: 40px">' +jsPsych.timelineVariable('combined') + '</span>';
      return stim
    } else{
      stim = '<span style="color: red; font-size: 40px">' +jsPsych.timelineVariable('combined') + '</span>';
      return stim
    }
  },
  stim_key_association: function(){
    if (good_words.includes(jsPsych.timelineVariable('combined'))){
        return 'right'
      } else {
        return 'left'
      }
  },
  html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
  bottom_instructions: 'Remember, if you make an error an X will appear. Please press the other button to continue if this occurs',
  force_correct_key_press: true,
  display_feedback: true,
  trial_duration: 3000, //Only if display_feedback is false
  left_category_key: 'e',
  right_category_key: 'i',
  left_category_label: ['Unpleasant'],
  right_category_label: ['Pleasant'],
  response_ends_trial: true
  }

//instructions for combined category change(black+unpleasant(left) and white+pleasant (right))
var instr_2 = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus:'<p> Now the four categories you saw separately will appear together. Remember, each word/image fits in only one of the four categories. The label/item colors may help you identify the appropriate category. </p>' +
  '<p> Use the E key for the two categories on the left and the I key for the two categories on the right. </p>' +
  '<p> Again, try to go as fast as possible without making mistakes. Correct errors by hitting the other key. Practice this combination now. </p>' +
  '<p> When you are ready, press [Space] to begin </p>',
  choices: " "
}

//combined black+unpleasant(left) and white+pleasant (right)
var compat_right_3_combined = {
  type: jsPsychIatHtml,
  stimulus: function(){
    if (jsPsych.timelineVariable('combined').indexOf('/') > -1){
      return jsPsych.timelineVariable('combined')
    } 
    else if(good_words.includes(jsPsych.timelineVariable('combined'))){
      stim = '<span style="color: green; font-size: 40px">' +jsPsych.timelineVariable('combined') + '</span>';
      return stim
    } else{
      stim = '<span style="color: red; font-size: 40px">' +jsPsych.timelineVariable('combined') + '</span>';
      return stim
    }
  },
  stim_key_association: function(){
    if (jsPsych.timelineVariable('combined').indexOf('/') > -1){
      if (jsPsych.timelineVariable('combined').indexOf('B') > -1){
        return 'left';
      } else
        return 'right';
        }
    else{
      if (good_words.includes(jsPsych.timelineVariable('combined'))){
        return 'right'
      } else {
        return 'left'
      }
    }
  },
  html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
  bottom_instructions: 'Remember, if you make an error an X will appear. Please press the other button to continue if this occurs',
  force_correct_key_press: true,
  display_feedback: true,
  trial_duration: 3000, //Only if display_feedback is false
  left_category_key: 'e',
  right_category_key: 'i',
  left_category_label: ['Black Americans or Unpleasant'],
  right_category_label: ['White Americans or Pleasant'],
  response_ends_trial: true
}


var compat_right_block1 = {
  timeline: [compat_right_1],
  timeline_variables: iat_imgs,
  randomize_order: true,
}

var compat_right_block2 = {
  timeline: [compat_right_2],
  timeline_variables: iat_word,
  randomize_order: true
}

var combined_block = {
  timeline: [compat_right_3_combined],
  timeline_variables: combined_array,
  randomize_order: true,
}
  


//note for later, code the first block for now but for when you have to do 4 different iat block choices
//make the category labels (and maybe stim key assoc) variables so you can randomly go through and assign it according to 
//whichever block is randomly chosen. can change the variable names compat_right etc later

//still need to fix undefined in iat_combined for compat_right_3 

//set gword, face, bword to a another array. example gword: x and x is x = [blah]. 

//make only one parameter all: x. have x be an array with every parameter and in the stimulus make a conditional 
//similar to how you presented choice key presses for the img vs html element

timeline.push(iat_instructions, compat_right_block1, instr_1, compat_right_block2, instr_2, combined_block);

jsPsych.run(timeline);


</script>
